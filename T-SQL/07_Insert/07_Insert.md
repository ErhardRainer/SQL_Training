# T-SQL INSERT ‚Äì √úbersicht

## 1 | Begriffsdefinition

| SQL-Term | Beschreibung |
|---|---|
| `INSERT` | F√ºgt Zeilen in eine Tabelle oder updatable View ein. |
| Zielobjekt | Tabelle oder updatable View, in die geschrieben wird. |
| Spaltenliste | Explizite Auflistung der Zielspalten ‚Äì vermeidet Br√ºche bei Schema√§nderungen. |
| `VALUES` (mehrzeilig) | Mehrere Zeilen in einem Statement einf√ºgen (`VALUES (...), (...), ...`). |
| `DEFAULT VALUES` | F√ºgt eine Zeile mit allen Standardwerten/`NULL` (gem√§√ü Definition) ein. |
| `INSERT ‚Ä¶ SELECT` | √úbernimmt Zeilen aus einer Abfrage/Join als Quelle. |
| `INSERT TOP (N)` | Begrenzt die Anzahl eingef√ºgter Zeilen (typisch in Kombi mit `SELECT`). |
| `OUTPUT`-Klausel | Liefert direkt die eingef√ºgten Werte (`inserted`) ‚Äì z. B. f√ºr Audit, Kaskaden-INSERTs. |
| Identit√§t (`IDENTITY`) | Automatische Schl√ºssel; neue Werte via `SCOPE_IDENTITY()` oder `OUTPUT inserted.<id>`. |
| `IDENTITY_INSERT` | Erlaubt das explizite Setzen von Identity-Werten (tempor√§r pro Tabelle). |
| Sequenz | Objektbasierte Nummernvergabe (`CREATE SEQUENCE`, `NEXT VALUE FOR`) ‚Äì tabellen√ºbergreifend nutzbar. |
| `DEFAULT`-Constraint | Spaltenstandard, der greift, wenn Spalte im `INSERT` fehlt oder `DEFAULT` angegeben ist. |
| Integrit√§tsregeln | `NOT NULL`, `CHECK`, `UNIQUE`, `FOREIGN KEY` ‚Äì validieren/erzwingen Datenqualit√§t. |
| Trigger | `AFTER/INSTEAD OF INSERT` reagieren auf Einf√ºgevorg√§nge; Pseudo-Tabelle `inserted`. |
| TVP (Table-Valued Parameter) | √úbergabe vieler Zeilen aus Anwendungen an Procs/Funktionen. |
| Bulkload | Hochdurchsatz mit `BULK INSERT`, `OPENROWSET(BULK ...)`, `bcp`; ggf. minimal geloggt. |
| Transaktion/Isolation | Atomarit√§t & Sichtbarkeit (`BEGIN/COMMIT`, `SNAPSHOT`, `SERIALIZABLE` ‚Ä¶). |
| Idempotenz/Upsert | Mehrfachausf√ºhrung ohne Duplikate; Muster: `INSERT ‚Ä¶ SELECT WHERE NOT EXISTS`, 2-Phasen-Upsert. |

---

## 2 | Struktur

### 2.1 | Grundlagen & Syntax
> **Kurzbeschreibung:** Minimales `INSERT`, Spaltenliste, `VALUES`, `DEFAULT VALUES`, typische Fehlermeldungen.

- üìì **Notebook:**  
  [`08_01_insert_grundlagen.ipynb`](08_01_insert_grundlagen.ipynb)

- üé• **YouTube:**  
  - [SQL Server INSERT Statement ‚Äì Basics](https://www.youtube.com/results?search_query=sql+server+insert+statement)

- üìò **Docs:**  
  - [INSERT (Transact-SQL)](https://learn.microsoft.com/en-us/sql/t-sql/statements/insert-transact-sql)

---

### 2.2 | Mehrzeilige `VALUES` & `DEFAULT`
> **Kurzbeschreibung:** Viele Zeilen effizient per `VALUES (...), (...)`; `DEFAULT` pro Spalte vs. `DEFAULT VALUES`.

- üìì **Notebook:**  
  [`08_02_values_multizeilig_default.ipynb`](08_02_values_multizeilig_default.ipynb)

- üé• **YouTube:**  
  - [INSERT Multiple Rows](https://www.youtube.com/results?search_query=sql+server+insert+multiple+rows)

- üìò **Docs:**  
  - [`DEFAULT`-Constraints & `DEFAULT VALUES`](https://learn.microsoft.com/en-us/sql/t-sql/statements/insert-transact-sql#default-values)

---

### 2.3 | `INSERT ‚Ä¶ SELECT` (aus Abfragen/Joins)
> **Kurzbeschreibung:** Zeilen aus anderen Tabellen/Joins √ºbernehmen; Spaltenzuordnung & Datentypkompatibilit√§t.

- üìì **Notebook:**  
  [`08_03_insert_select_joins.ipynb`](08_03_insert_select_joins.ipynb)

- üé• **YouTube:**  
  - [INSERT INTO ‚Ä¶ SELECT ‚Äì Patterns](https://www.youtube.com/results?search_query=sql+server+insert+into+select)

- üìò **Docs:**  
  - [INSERT ‚Äì `SELECT` als Quelle](https://learn.microsoft.com/en-us/sql/t-sql/statements/insert-transact-sql#inserting-data-from-other-tables)

---

### 2.4 | `OUTPUT`-Klausel (IDs & Delta erfassen)
> **Kurzbeschreibung:** Neu erzeugte Schl√ºssel/Spaltenwerte direkt abgreifen; Kaskaden-INSERT (Parent‚ÜíChild) mit `OUTPUT INTO`.

- üìì **Notebook:**  
  [`08_04_output_clause_insert.ipynb`](08_04_output_clause_insert.ipynb)

- üé• **YouTube:**  
  - [OUTPUT Clause ‚Äì INSERT](https://www.youtube.com/results?search_query=sql+server+output+clause+insert)

- üìò **Docs:**  
  - [`OUTPUT` (Transact-SQL)](https://learn.microsoft.com/en-us/sql/t-sql/queries/output-clause-transact-sql)

---

### 2.5 | Identit√§ten: `IDENTITY`, `SCOPE_IDENTITY()`, `IDENTITY_INSERT`
> **Kurzbeschreibung:** Sicher neue ID beziehen (`SCOPE_IDENTITY()`/`OUTPUT`), `@@IDENTITY`/`IDENT_CURRENT` vermeiden; gezielt `IDENTITY_INSERT`.

- üìì **Notebook:**  
  [`08_05_identity_scope_identity.ipynb`](08_05_identity_scope_identity.ipynb)

- üé• **YouTube:**  
  - [Identity Columns & SCOPE_IDENTITY](https://www.youtube.com/results?search_query=sql+server+scope_identity)

- üìò **Docs:**  
  - [`IDENTITY`-Eigenschaft](https://learn.microsoft.com/en-us/sql/t-sql/statements/create-table-transact-sql-identity-property)  
  - [`SCOPE_IDENTITY`](https://learn.microsoft.com/en-us/sql/t-sql/functions/scope-identity-transact-sql) ¬∑ [`SET IDENTITY_INSERT`](https://learn.microsoft.com/en-us/sql/t-sql/statements/set-identity-insert-transact-sql)

---

### 2.6 | Sequenzen (`CREATE SEQUENCE`, `NEXT VALUE FOR`)
> **Kurzbeschreibung:** Schl√ºssel ohne Tabellengebindung; Nutzung in `INSERT`/Default-Constraints; L√ºcken/Parallelit√§t.

- üìì **Notebook:**  
  [`08_06_sequence_next_value_for.ipynb`](08_06_sequence_next_value_for.ipynb)

- üé• **YouTube:**  
  - [SQL Server Sequences ‚Äì Tutorial](https://www.youtube.com/results?search_query=sql+server+sequence+next+value+for)

- üìò **Docs:**  
  - [`CREATE SEQUENCE`](https://learn.microsoft.com/en-us/sql/t-sql/statements/create-sequence-transact-sql) ¬∑ [`NEXT VALUE FOR`](https://learn.microsoft.com/en-us/sql/t-sql/functions/next-value-for-transact-sql)

---

### 2.7 | Constraints & Trigger (`AFTER/INSTEAD OF INSERT`)
> **Kurzbeschreibung:** Validierung durch `CHECK`/`FOREIGN KEY`/`UNIQUE`; Triggerlogik & Pseudo-Tabelle `inserted`.

- üìì **Notebook:**  
  [`08_07_constraints_trigger_insert.ipynb`](08_07_constraints_trigger_insert.ipynb)

- üé• **YouTube:**  
  - [INSERT Triggers Explained](https://www.youtube.com/results?search_query=sql+server+insert+trigger)

- üìò **Docs:**  
  - [CHECK/UNIQUE/FOREIGN KEY ‚Äì √úbersicht](https://learn.microsoft.com/en-us/sql/relational-databases/tables/tables)  
  - [CREATE TRIGGER](https://learn.microsoft.com/en-us/sql/t-sql/statements/create-trigger-transact-sql)

---

### 2.8 | Transaktionen & Fehlerbehandlung
> **Kurzbeschreibung:** `BEGIN/COMMIT/ROLLBACK`, `TRY‚Ä¶CATCH`, `THROW`, `XACT_ABORT ON` ‚Äì sauber abbrechen & signalisieren.

- üìì **Notebook:**  
  [`08_08_transaktionen_try_catch_insert.ipynb`](08_08_transaktionen_try_catch_insert.ipynb)

- üé• **YouTube:**  
  - [TRY‚Ä¶CATCH & THROW ‚Äì DML](https://www.youtube.com/results?search_query=sql+server+try+catch+throw)

- üìò **Docs:**  
  - [`TRY‚Ä¶CATCH`](https://learn.microsoft.com/en-us/sql/t-sql/language-elements/try-catch-transact-sql) ¬∑ [`THROW`](https://learn.microsoft.com/en-us/sql/t-sql/language-elements/throw-transact-sql)  
  - [`SET XACT_ABORT`](https://learn.microsoft.com/en-us/sql/t-sql/statements/set-xact-abort-transact-sql)

---

### 2.9 | Table-Valued Parameters (TVP) & `INSERT EXEC`
> **Kurzbeschreibung:** Gro√üe Datenmengen aus Apps effizient √ºbergeben; Alternativen: `INSERT EXEC proc` f√ºr Zwischenergebnisse.

- üìì **Notebook:**  
  [`08_09_tvp_insert_exec.ipynb`](08_09_tvp_insert_exec.ipynb)

- üé• **YouTube:**  
  - [Table-Valued Parameters ‚Äì Demo](https://www.youtube.com/results?search_query=sql+server+table+valued+parameters)

- üìò **Docs:**  
  - [Verwenden von TVPs](https://learn.microsoft.com/en-us/sql/relational-databases/tables/use-table-valued-parameters-database-engine)  
  - [`INSERT EXEC` ‚Äì Hinweise](https://learn.microsoft.com/en-us/sql/t-sql/language-elements/insert-transact-sql#inserting-data-by-executing-a-stored-procedure)

---

### 2.10 | Bulkload: `BULK INSERT`, `OPENROWSET(BULK)`, `bcp`
> **Kurzbeschreibung:** Hochdurchsatz-Loads, Dateiformate, Fehlerzeilen; minimal logging unter geeigneten Bedingungen.

- üìì **Notebook:**  
  [`08_10_bulk_insert_openrowset_bcp.ipynb`](08_10_bulk_insert_openrowset_bcp.ipynb)

- üé• **YouTube:**  
  - [BULK INSERT ‚Äì Praxis](https://www.youtube.com/results?search_query=sql+server+bulk+insert+tutorial)

- üìò **Docs:**  
  - [`BULK INSERT`](https://learn.microsoft.com/en-us/sql/t-sql/statements/bulk-insert-transact-sql) ¬∑ [`OPENROWSET(BULK)`](https://learn.microsoft.com/en-us/sql/t-sql/functions/openrowset-transact-sql)  
  - [bcp Utility](https://learn.microsoft.com/en-us/sql/tools/bcp-utility)

---

### 2.11 | `SELECT INTO` vs. `INSERT ‚Ä¶ SELECT`
> **Kurzbeschreibung:** Neue Tabelle on-the-fly erzeugen vs. in bestehende Struktur laden; Logging/Parallelit√§t/Indizes.

- üìì **Notebook:**  
  [`08_11_select_into_vs_insert_select.ipynb`](08_11_select_into_vs_insert_select.ipynb)

- üé• **YouTube:**  
  - [SELECT INTO vs INSERT SELECT](https://www.youtube.com/results?search_query=sql+server+select+into+vs+insert+select)

- üìò **Docs:**  
  - [`SELECT INTO`](https://learn.microsoft.com/en-us/sql/t-sql/queries/select-into-clause-transact-sql)  
  - [`INSERT ‚Ä¶ SELECT`](https://learn.microsoft.com/en-us/sql/t-sql/statements/insert-transact-sql#inserting-data-from-other-tables)

---

### 2.12 | Batching & Durchsatz-Optimierung
> **Kurzbeschreibung:** Paketgr√∂√üen, `TABLOCK`, Indizes/Triggers deaktivieren (wo vertretbar), Wiederaufnahmef√§hige Loads.

- üìì **Notebook:**  
  [`08_12_batching_throughput.ipynb`](08_12_batching_throughput.ipynb)

- üé• **YouTube:**  
  - [High-Throughput Inserts](https://www.youtube.com/results?search_query=sql+server+high+throughput+insert)

- üìò **Docs/Blog:**  
  - [Index Design & Auswirkungen auf DML](https://learn.microsoft.com/en-us/sql/relational-databases/sql-server-index-design-guide)  
  - [Minimal Logging ‚Äì √úberblick](https://learn.microsoft.com/en-us/sql/relational-databases/sql-server-transaction-log-architecture-and-management)

---

### 2.13 | Idempotente Inserts & Upsert ohne `MERGE`
> **Kurzbeschreibung:** Doppelte vermeiden (`WHERE NOT EXISTS`/`EXCEPT`/`LEFT JOIN ‚Ä¶ IS NULL`) und robustes 2-Phasen-Upsert.

- üìì **Notebook:**  
  [`08_13_idempotente_inserts_upsert.ipynb`](08_13_idempotente_inserts_upsert.ipynb)

- üé• **YouTube:**  
  - [UPSERT Patterns (ohne MERGE)](https://www.youtube.com/results?search_query=sql+server+upsert+without+merge)

- üìò **Docs/Blog:**  
  - [`MERGE` ‚Äì Referenz (Hinweise & Risiken)](https://learn.microsoft.com/en-us/sql/t-sql/statements/merge-transact-sql)  
  - [Aaron Bertrand ‚Äì Problems with MERGE](https://sqlblog.org/2011/06/20/merge-what-was-i-thinking)

---

### 2.14 | Sicherheit & RLS (INSERT-Rechte, Block-Predicates)
> **Kurzbeschreibung:** `INSERT`-Berechtigungen, Spaltenrechte, RLS-Block/Filter-Predicates k√∂nnen Inserts verhindern.

- üìì **Notebook:**  
  [`08_14_sicherheit_rls_insert.ipynb`](08_14_sicherheit_rls_insert.ipynb)

- üé• **YouTube:**  
  - [Row-Level Security ‚Äì Overview](https://www.youtube.com/results?search_query=sql+server+row+level+security)

- üìò **Docs:**  
  - [RLS ‚Äì Sicherheitsrichtlinien](https://learn.microsoft.com/en-us/sql/relational-databases/security/row-level-security)  
  - [Berechtigungen: `INSERT` & Spaltenrechte](https://learn.microsoft.com/en-us/sql/relational-databases/security/permissions-database-engine)

---

### 2.15 | Betrieb & Qualit√§tssicherung
> **Kurzbeschreibung:** `@@ROWCOUNT`, Fehler-/Duplikatprotokoll, Wiederholbarkeit, Monitoring (DMVs/Extended Events).

- üìì **Notebook:**  
  [`08_15_ops_quality_insert.ipynb`](08_15_ops_quality_insert.ipynb)

- üé• **YouTube:**  
  - [Monitoring DML ‚Äì DMVs](https://www.youtube.com/results?search_query=sql+server+dmv+monitoring)

- üìò **Docs:**  
  - [`@@ROWCOUNT`](https://learn.microsoft.com/en-us/sql/t-sql/functions/rowcount-transact-sql)  
  - [DMVs ‚Äì Referenz](https://learn.microsoft.com/en-us/sql/relational-databases/system-dynamic-management-views/system-dynamic-management-views)

---

### 2.16 | Anti-Patterns
> **Kurzbeschreibung:** `SELECT MAX(id)+1` statt Identity/Sequence, `@@IDENTITY`, fehlende Spaltenliste, RBAR-Schleifen, ungepr√ºfte Trigger.

- üìì **Notebook:**  
  [`08_16_insert_anti_patterns.ipynb`](08_16_insert_anti_patterns.ipynb)

- üé• **YouTube:**  
  - [Common INSERT Mistakes](https://www.youtube.com/results?search_query=sql+server+insert+mistakes)

- üìò **Docs/Blog:**  
  - [Best Practices ‚Äì Identity & Sequences](https://learn.microsoft.com/en-us/sql/relational-databases/tables/sequence-numbers)  
  - [Erik Darling ‚Äì Avoiding RBAR](https://www.erikdarlingdata.com/)

---

## 3 | Weiterf√ºhrende Informationen

- üìò Microsoft Learn: [INSERT (Transact-SQL)](https://learn.microsoft.com/en-us/sql/t-sql/statements/insert-transact-sql)  
- üìò Microsoft Learn: [`OUTPUT`-Klausel](https://learn.microsoft.com/en-us/sql/t-sql/queries/output-clause-transact-sql)  
- üìò Microsoft Learn: [`SCOPE_IDENTITY()`](https://learn.microsoft.com/en-us/sql/t-sql/functions/scope-identity-transact-sql) ¬∑ [`IDENT_CURRENT`/`@@IDENTITY`](https://learn.microsoft.com/en-us/sql/t-sql/functions/ident-current-transact-sql)  
- üìò Microsoft Learn: [`SET IDENTITY_INSERT`](https://learn.microsoft.com/en-us/sql/t-sql/statements/set-identity-insert-transact-sql)  
- üìò Microsoft Learn: [`CREATE SEQUENCE` / `NEXT VALUE FOR`](https://learn.microsoft.com/en-us/sql/t-sql/statements/create-sequence-transact-sql)  
- üìò Microsoft Learn: [Table-Valued Parameters](https://learn.microsoft.com/en-us/sql/relational-databases/tables/use-table-valued-parameters-database-engine)  
- üìò Microsoft Learn: [`BULK INSERT`](https://learn.microsoft.com/en-us/sql/t-sql/statements/bulk-insert-transact-sql) ¬∑ [`OPENROWSET(BULK)`](https://learn.microsoft.com/en-us/sql/t-sql/functions/openrowset-transact-sql) ¬∑ [bcp](https://learn.microsoft.com/en-us/sql/tools/bcp-utility)  
- üìò Microsoft Learn: [`SELECT INTO`](https://learn.microsoft.com/en-us/sql/t-sql/queries/select-into-clause-transact-sql)  
- üìò Microsoft Learn: [Transaktionsprotokoll ‚Äì Architektur & Minimal Logging](https://learn.microsoft.com/en-us/sql/relational-databases/sql-server-transaction-log-architecture-and-management)  
- üìò Microsoft Learn: [CREATE TRIGGER ‚Äì INSERT](https://learn.microsoft.com/en-us/sql/t-sql/statements/create-trigger-transact-sql)  
- üìò Microsoft Learn: [RLS ‚Äì Block/Filter Predicates](https://learn.microsoft.com/en-us/sql/relational-databases/security/row-level-security)  
- üìù Blog (Aaron Bertrand): [Problems with MERGE](https://sqlblog.org/2011/06/20/merge-what-was-i-thinking)  
- üìù Blog (SQLPerformance): [High-Throughput Inserts & Minimal Logging](https://www.sqlperformance.com/?s=minimal+logging)  
- üìù Blog (Brent Ozar): [SARGability & DML Overhead](https://www.brentozar.com/archive/2018/02/sargable-queries/)  
- üé• YouTube: [INSERT INTO ‚Ä¶ SELECT ‚Äì Best Practices](https://www.youtube.com/results?search_query=sql+server+insert+into+select+best+practices)  
- üé• YouTube (Data Exposed): [Table-Valued Parameters](https://www.youtube.com/results?search_query=data+exposed+table+valued+parameters)  
